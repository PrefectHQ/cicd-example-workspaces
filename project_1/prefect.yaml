name: cicd-example-workspaces
prefect-version: 2.16.2

build: null

push:
  - prefect_aws.deployments.steps.push_to_s3:
      requires: prefect-aws
      bucket: cicd-example-workspaces
      folder: "{{ $PROJECT_NAME }}_{{ $ENVIRONMENT }}"
      credentials: "{{ prefect.blocks.aws-credentials.ecs-worker-changes }}"

pull:
  - prefect_aws.deployments.steps.pull_from_s3:
      requires: prefect-aws
      bucket: cicd-example-workspaces
      folder: "{{ $PROJECT_NAME }}_{{ $ENVIRONMENT }}"
      credentials: "{{ prefect.blocks.aws-credentials.ecs-worker-changes }}"

deployments:
  - name: my-project-1-deployment
    entrypoint: "{{ $PROJECT_NAME }}_{{ $ENVIRONMENT}}/flow.py:hello"
    work_pool:
      name: k8s-demo
      work_queue_name: default
      job_variables:
        image: "{{ $IMAGE_NAME }}"
